<body>

<h1>ğŸ“– Ø®ØªÙ…Ø© Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„Ø¹Ø§Ø¦Ù„ÙŠØ©</h1>
<p>Ø§Ø¶ØºØ· âœ”ï¸ ÙˆØ³ÙŠØªÙ… Ø§Ù„Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù„Ù„Ø¬Ù…ÙŠØ¹</p>
<div id="status" style="margin:10px;color:#555"></div>

<table id="tbl"></table>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const API = "https://script.google.com/macros/s/AKfycbwcNKAqNPe3O0ZjDJ_E4HSRrNnlvnXmQ453h84DIuy-B-HWRKLQqkkhmARCdtia00IKNg/exec"; 

  const names = [
    "Ø§Ù… Ù…Ø­Ù…ÙˆØ¯","Ø­Ù„ÙŠÙ…","ÙØ§Ø·Ù…Ø©","Ø³Ø§Ø±Ø©","Ù…Ø­Ù…ÙˆØ¯","Ø§Ø³Ø±Ø§Ø¡",
    "Ø¯Ø§Ù†ÙŠØ§","Ø³Ø¹Ø§Ø¯","Ø´Ø§Ù…","Ù…Ø­Ù…Ø¯","Ø¨ØªÙˆÙ„","Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡","Ø­Ø³Ù†","Ø¬Ø§Ø¯"
  ];
  const parts = 30;

  const status = document.getElementById("status");
  const table = document.getElementById("tbl");

  function setStatus(msg){ status.textContent = msg; }

  if (!table) {
    console.error("Table #tbl not found.");
    return;
  }

  // Ø¨Ù†Ø§Ø¡ Ø±Ø£Ø³ Ø§Ù„Ø¬Ø¯ÙˆÙ„
  let header = "<tr><th>Ø§Ù„Ø§Ø³Ù…</th>";
  for (let i = 1; i <= parts; i++) header += `<th>${i}</th>`;
  header += "</tr>";
  table.innerHTML = header;

  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø´ÙŠØª
  setStatus("Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...");
  fetch(API)
    .then(r => r.json())
    .then(data => {
      const db = data.slice(1); // ÙŠØªØ¬Ø§ÙˆØ² Ø§Ù„Ù‡ÙŠØ¯Ø± name/part/done

      names.forEach(name => {
        let row = `<tr><th>${name}</th>`;
        for (let i = 1; i <= parts; i++) {
          const found = db.find(x => x[0] === name && Number(x[1]) === i && Number(x[2]) === 1);
          const checked = found ? "checked" : "";
          row += `<td><input type="checkbox" ${checked} data-name="${name}" data-part="${i}"></td>`;
        }
        row += "</tr>";
        table.innerHTML += row;
      });

      setStatus("âœ… Ø¬Ø§Ù‡Ø²");
    })
    .catch(err => {
      console.error("Fetch failed:", err);
      setStatus("âŒ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ØªØ£ÙƒØ¯ Ù…Ù† Ø±Ø§Ø¨Ø· API ÙˆØ§Ù„Ù†Ø´Ø± (Anyone).");
    });

  // Ø­ÙØ¸ Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø£ÙŠ Checkbox
  table.addEventListener("change", (e) => {
    if (e.target && e.target.type === "checkbox") {
      const name = e.target.dataset.name;
      const part = Number(e.target.dataset.part);
      const done = e.target.checked ? 1 : 0;

      setStatus("ğŸ’¾ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...");

      fetch(API, {
        method: "POST",
        mode: "no-cors",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ name, part, done })
      })
      .then(() => setStatus("âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸"))
      .catch(err => {
        console.error("Save failed:", err);
        setStatus("âŒ ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸");
      });
    }
  });
});
</script>

</body>
